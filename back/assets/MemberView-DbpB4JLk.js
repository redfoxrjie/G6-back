import{T as k}from"./ToggleSwitch-z5GpLJOK.js";import{_ as f,o as u,c as m,a as e,f as d,t as o,w,g as b,p as v,d as M,i as g,b as P,v as V,F as x,r as I,j as p}from"./index-CcafUdp0.js";const S={props:{member:{type:Object,required:!0},visible:{type:Boolean,required:!0}},methods:{closeModal(){this.$emit("close")}}},r=t=>(v("data-v-62b590fd"),t=t(),M(),t),D={class:"modal-dialog"},N={class:"modal-content"},Q={class:"modal-header"},T=r(()=>e("h5",{class:"modal-title"},"會員詳細資料",-1)),B={class:"modal-body"},U=r(()=>e("strong",null,"會員ID：",-1)),j=r(()=>e("strong",null,"姓名：",-1)),q=r(()=>e("strong",null,"會員帳號：",-1)),E=r(()=>e("strong",null,"連絡電話：",-1)),F=r(()=>e("strong",null,"電子信箱：",-1)),L=r(()=>e("strong",null,"生日：",-1)),O=r(()=>e("strong",null,"國家：",-1)),z=r(()=>e("strong",null,"違規點數：",-1)),A=r(()=>e("strong",null,"帳號啟用狀態：",-1)),G={class:"modal-footer"};function H(t,s,i,_,a,l){return i.visible?(u(),m("div",{key:0,class:"modal",onClick:s[2]||(s[2]=w((...c)=>l.closeModal&&l.closeModal(...c),["self"]))},[e("div",D,[e("div",N,[e("div",Q,[T,e("button",{type:"button",class:"btn-close",onClick:s[0]||(s[0]=(...c)=>l.closeModal&&l.closeModal(...c))})]),e("div",B,[e("p",null,[U,d(),e("span",null,o(i.member.id),1)]),e("p",null,[j,d(),e("span",null,o(i.member.name),1)]),e("p",null,[q,d(),e("span",null,o(i.member.account),1)]),e("p",null,[E,d(),e("span",null,o(i.member.phone),1)]),e("p",null,[F,d(),e("span",null,o(i.member.email),1)]),e("p",null,[L,d(),e("span",null,o(i.member.birthday),1)]),e("p",null,[O,d(),e("span",null,o(i.member.country),1)]),e("p",null,[z,d(),e("span",null,o(i.member.point),1)]),e("p",null,[A,d(),e("span",null,o(i.member.active?"是":"否"),1)])]),e("div",G,[e("button",{type:"button",class:"btn btn-secondary",onClick:s[1]||(s[1]=(...c)=>l.closeModal&&l.closeModal(...c))},"關閉")])])])])):b("",!0)}const J=f(S,[["render",H],["__scopeId","data-v-62b590fd"]]),K={components:{ToggleSwitch:k,MemberModal:J},data(){return{members:[],searchQuery:"",totalCount:0,activeCount:0,inactiveCount:0,page:1,perPage:10,loading:!1,error:null,selectedMember:{},isModalVisible:!1}},computed:{filteredMembers(){return this.members},totalPages(){return Math.ceil(this.totalCount/this.perPage)}},methods:{showMemberDetails(t){this.selectedMember=t,this.isModalVisible=!0},fetchMembers(){this.loading=!0,this.error=null,fetch(`https://tibamef2e.com/cid101/g6/api/back_getUserInfo.php?page=${this.page}&perPage=${this.perPage}&searchQuery=${this.searchQuery}`).then(t=>{if(!t.ok)throw new Error("Network response was not ok");return t.json()}).then(t=>{t.success?(this.members=t.members,this.members=t.members.map(s=>({...s,active:!0})),this.totalCount=t.total,this.calculateMemberCounts()):this.error=t.message}).catch(t=>{this.error="There was a problem with the fetch operation: "+t.message}).finally(()=>{this.loading=!1})},updateMemberStatus(t,s){const i=this.members.find(_=>_.id===t);i&&(i.active=s,this.calculateMemberCounts())},calculateMemberCounts(){this.activeCount=this.members.filter(t=>t.active).length,this.inactiveCount=this.members.filter(t=>!t.active).length},searchMembers(){this.page=1,this.fetchMembers()},prevPage(){this.page>1&&(this.page--,this.fetchMembers())},nextPage(){this.page<this.totalPages&&(this.page++,this.fetchMembers())}},mounted(){this.fetchMembers()}},y=t=>(v("data-v-7b4196dd"),t=t(),M(),t),R={class:"member_management"},W={class:"member_management_container"},X=y(()=>e("h3",null,"會員管理",-1)),Y={class:"search-container"},Z={key:0,class:"members-table"},$=y(()=>e("thead",null,[e("tr",null,[e("th",null,"會員ID"),e("th",null,"姓名"),e("th",null,"帳號"),e("th",null,"電子信箱"),e("th",null,"啟用狀態"),e("th",null,"詳細資料")])],-1)),ee=["onClick"],te={key:1,class:"loading"},se={key:2,class:"error"},le={class:"pagination"},ne=["disabled"],oe=["disabled"];function ie(t,s,i,_,a,l){const c=g("toggle-switch"),C=g("member-modal");return u(),m("div",R,[e("div",W,[X,e("div",Y,[P(e("input",{type:"text","onUpdate:modelValue":s[0]||(s[0]=n=>a.searchQuery=n),placeholder:"會員ID"},null,512),[[V,a.searchQuery]]),e("button",{onClick:s[1]||(s[1]=(...n)=>l.searchMembers&&l.searchMembers(...n))},"搜尋")]),!a.loading&&!a.error?(u(),m("table",Z,[$,e("tbody",null,[(u(!0),m(x,null,I(l.filteredMembers,n=>(u(),m("tr",{key:n.id},[e("td",null,o(n.id),1),e("td",null,o(n.name),1),e("td",null,o(n.account),1),e("td",null,o(n.email),1),e("td",null,[p(c,{modelValue:n.active,"onUpdate:modelValue":[h=>n.active=h,h=>l.updateMemberStatus(n.id,h)]},null,8,["modelValue","onUpdate:modelValue"])]),e("td",null,[e("button",{type:"button",class:"btn btn-primary",onClick:h=>l.showMemberDetails(n)},"詳細資料",8,ee)])]))),128))])])):b("",!0),a.loading?(u(),m("div",te,"加載中...")):b("",!0),a.error?(u(),m("div",se,o(a.error),1)):b("",!0),e("div",le,[e("button",{onClick:s[2]||(s[2]=(...n)=>l.prevPage&&l.prevPage(...n)),disabled:a.page===1},"‹",8,ne),e("span",null,o(a.page)+" / "+o(l.totalPages),1),e("button",{onClick:s[3]||(s[3]=(...n)=>l.nextPage&&l.nextPage(...n)),disabled:a.page===l.totalPages},"›",8,oe)])]),p(C,{member:a.selectedMember,visible:a.isModalVisible,onClose:s[4]||(s[4]=n=>a.isModalVisible=!1)},null,8,["member","visible"])])}const de=f(K,[["render",ie],["__scopeId","data-v-7b4196dd"]]);export{de as default};
